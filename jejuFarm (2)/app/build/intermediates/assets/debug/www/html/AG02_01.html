<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=medium-dpi" />
<title>동네예보</title>
<link type="text/css" href="../css/smart/style_farm.css" rel="stylesheet" />
<link rel="stylesheet" href="../css/egovframework/mbl/cmm/jquery.mobile-1.0b3.min.css" />
<link rel="stylesheet" href="../css/egovframework/mbl/cmm/EgovMobile.css" /> 
<script type="text/javascript" src="../js/egovframework/mbl/cmm/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="../js/egovframework/mbl/cmm/EgovMobile.js"></script>
<!-- <script type="text/javascript" src="../js/egovframework/mbl/cmm/datepicker/jquery.mobile.datebox.js"></script> -->
<script type="text/javascript" src="../js/smart/common.js"></script>
<script type="text/javascript" src="../js/smart/DB_Util.js"></script>
<script type="text/javascript" src="../js/egovframework/mbl/cmm/jquery.mobile-1.0b3.min.js"></script>
<script type="text/javascript">	
var default_area = "";
$(document).ready(function() {
	$('#Windex').hide();
	$('#area_edit_id').hide();	
	imagefade();
	selectedAlla();
});

function selectedAlla() {
	DBinit();	
	db.transaction(
	function(tx) {			
		tx.executeSql(
		"SELECT * FROM " + table + " order by number  desc",[],
		function(tx, results) {
			var len = results.rows.length;
			var area_add_li = "";
			var area_edit_li = "";
			var j = len;
			var GET_GCODE = window.localStorage.getItem("zone");
			var area_title = "";
			if(len <= 3){
				for ( var i = 0; i < len; i++) {
					if(results.rows.item(i).AREA == "대정읍/마라도포함") area_title = "대정읍/마라도";
					else area_title = results.rows.item(i).AREA;
					
					area_add_li = "<div class='left'></div>" 
						+ "<div class='right'></div>" 
						+ "<a href='javascript:show_area("+results.rows.item(i).TYPE+", "+i+");'>"
						+ area_title
						+ "</a>";							
				
					area_edit_li = "<a href='AG02_01.html' onclick='javascript:deleteArea("+results.rows.item(i).TYPE+");' rel='external' data-ajax='false'>"
						+ "<font style='color:#fff;'>" 
						+ results.rows.item(i).CITY
						+ " "
						+ results.rows.item(i).AREA
						+ "</font>"
						+	"<div class='delect_btn'><font style='color:#FFF;'>삭제</font></div>"
						+ "</a>";
						
					default_area = results.rows.item(0).TYPE
					$('#areaList'+i).html(area_add_li);
					$('#editList'+i).html(area_edit_li);
				}
				for ( var i = 0; i < 3-len; i++) {					
					area_add_li = "<a href='AG02_01_set.html' rel='external' data-ajax='false'><font class='add_font'>+ 지역추가</font></a>";
					area_edit_li = "<a href='AG02_01_set.html' rel='external' data-ajax='false'><font style='color:#fff;'>+ 지역추가</font></a>";
					
					$('#areaList'+j).html(area_add_li);
					$('#editList'+j).html(area_edit_li);
					j++;
				}	
			}
			
			if(len == 0){
				initList();	
			}
			else{
				if(GET_GCODE == null){
						initList(default_area);	
				}
				else{
					show_area(GET_GCODE,len-1);
				}
			}
		})
	}, function(tx, err) {
	}, function() {
	});
}

function initList(code) {
	var GET_GCODE = code;
	if(code != null){
		$.getJSON(farm_url + "/app/weather/selectWeatherRss2.do?zone="+GET_GCODE, $('#baseVO').serialize(), function(json){
			var real_weather = "";
			var get_weather = "";      	
		    var real_vo = json.resultList[0];
		    // 소수 3째자리에서 버림
		    var real_ws_set = parseInt(real_vo.ws*100)/100;
		    var sky_num = "";
		    var today = new Date();
		    var get_today = today.getFullYear() + "년 " + (today.getMonth()+1) + "월 " + today.getDate() + "일";
		    
		    if(real_vo.sky < 4 && real_vo.hour > 20){//20시 기준으로 낮 밤 나눔.   	
		    	sky_num = 1 + real_vo.sky;
		    }
		    else{	    	
		    	sky_num = real_vo.sky; 
		    }
    
	       	real_weather += '<div class="weather_icon"><img src="../images/weather/w_'+sky_num+'.png" width="167" height="188"></div>';
	       	real_weather += '<div class="weather_text">';
	       	real_weather += 	'<div class="text_main">';
	       	real_weather += 		'<font class="weather_time">'+get_today+' '+real_vo.hour+'시 기준</font>';
	       	real_weather += 		'<font class="weather_tem">'+real_vo.temp+'℃</font>';
	       	real_weather += 		'<font class="weather_exp">'+real_vo.wfKor+'</font>';
	       	real_weather += 	'</div>'; 
	       	real_weather += 	'<div class="text_table">';
	       	real_weather += 		'<img class="left" src="../images/weather/text_bg_left.png" width="4" height="109">';
	       	real_weather += 		'<img class="right" src="../images/weather/text_bg_right.png" width="4" height="109">';
	       	real_weather += 		'<table>';
	       	real_weather += 			'<tr class="weather_else">';
	       	real_weather += 				'<td class="span">풍&nbsp;&nbsp;&nbsp;&nbsp;향</td>';
	       	real_weather += 				'<td class="divline">|</td>';
	       	real_weather += 				'<td class="tx">'+real_vo.wdKor+'풍</td>';
	       	real_weather += 			'</tr>';
	       	real_weather += 			'<tr class="weather_else">';
	       	real_weather += 				'<td class="span">풍&nbsp;&nbsp;&nbsp;&nbsp;속</td>';
	       	real_weather += 				'<td class="divline">|</td>';
	       	real_weather += 				'<td class="tx">'+real_ws_set+'m/s</td>';
	       	real_weather += 			'</tr>';
	       	real_weather += 			'<tr class="weather_else">';
	       	real_weather += 				'<td class="span">습&nbsp;&nbsp;&nbsp;&nbsp;도</td>';
	       	real_weather += 				'<td class="divline">|</td>';
	       	real_weather += 				'<td class="tx">'+real_vo.reh+'%</td>';
	       	real_weather += 			'</tr>';
	       	real_weather += 			'<tr class="weather_else">';
	       	real_weather += 				'<td class="span">강수량</td>';
	       	real_weather += 				'<td class="divline">|</td>';
	       	real_weather += 				'<td class="tx">'+real_vo.pop+'mm</td>';
	       	real_weather += 			'</tr>';
	       	real_weather += 		'</table>'; 
	       	real_weather += 	'</div>'; 
	       	real_weather += '</div>'; 
	       		       	
	       	get_weather += '<table class="weather_list" frame="hsides" rules="rows" border="1" bordercolor="#656565">';
	       	get_weather +=		'<colgroup>'
	       	get_weather +=			'<col width=200px;>'
	       	get_weather +=			'<col width=30px;>'
	       	get_weather +=			'<col width=100px;>'
	       	get_weather +=		'</colgroup>'
	    	for (var i = 0; i < 4; i++) { 
				var vo = json.resultList[i];
				var schdulKindNm = "";
				var am_pm = "";
				var vo_sky_num = vo.sky;
			
				if(vo.hour < 12){
					am_pm = "오전";
				}
				else if(vo.sky < 4 && vo.hour > 20){
					am_pm = "오후";
					vo_sky_num = 1 + vo.sky; 
				}
				else{
					am_pm = "오후";				
				}

				get_weather += '<tr>';
				get_weather += 	'<td>'+am_pm+" "+vo.hour+'시</td>';
				get_weather += 	'<td><img src="../images/weather/list_arrow.png" alt="화살표" width="4" height="8"/></td>';
				get_weather += 	'<td><img src="../images/weather/s_w_'+vo_sky_num+'.png" alt="현재날씨아이콘" width="27" height="27"/></td>';
				get_weather += 	'<td class="col_4">'+vo.wfKor+' | '+vo.temp+'℃</td>';
				get_weather += '</tr>';  
	    	}
	       	get_weather +=	'</table>'
	    	    	
		    $('#real_weather').html(real_weather);
			$('#get_weather').html(get_weather);
			$('#LoadingImage').hide();
			
		});
	}
 	
	else{		
		$('#Windex').show();	   	
	   	var cha = document.getElementById("areaList0");
		var alt = cha.getAttribute("class");
		cha.setAttribute("class", "");
	    $('#LoadingImage').hide();
	}	
}
var pre_menu = 0;
function show_area(code, menu){
	initList(code);
	
	var cha = document.getElementById("areaList"+menu);
	var alt = cha.getAttribute("class");
	
	var pre_cha = document.getElementById("areaList"+pre_menu);
	var pre_alt = pre_cha.getAttribute("class");

	if(alt == ""){
		cha.setAttribute("class", "select");
		pre_cha.setAttribute("class", "");
	}
	else{
		cha.setAttribute("class", "");
		pre_cha.setAttribute("class", "select");
	}
	pre_menu = menu;
}

var btn_on_off = 0;
function edit_on_off(){
	//btn_on_off = 0/off 1/on	
	if(btn_on_off == 0)
	{
		$('#area_edit_id').show();
		document.getElementById('title_W_id').style.backgroundImage = 'url(../images/weather/top_bar02.png)';
		document.getElementById('btn_edit_id').style.backgroundImage = 'url(../images/weather/edit-btn_r.png)';
		btn_on_off = 1;		
	}
	else
	{		
		$('#area_edit_id').hide();
		document.getElementById('title_W_id').style.backgroundImage = 'url(../images/weather/top_bar.png)';
		document.getElementById('btn_edit_id').style.backgroundImage = 'url(../images/weather/edit-btn.png)';
		btn_on_off = 0; 
	}
}
</script>
</head>
<body>
<div id="wrap">
	<div id="header" class="h_bg02_etc">
        <h2>농업기술원</h2>
        <a href="index.html" rel="external" data-ajax="false" class="btn_home"><img src="../images/smart/main/home.png" alt="홈으로" width="32" height="29"/></a>
	    <div class="sitemap">
			<a href="javascript:sitemap_onoff();"><img src="../images/smart/main/sitemap.png" alt="사이트맵" width="32" height="29"/></a>
		</div>
	</div>
	<!-- // header -->
	<!-------------------------사이트맵 메뉴 ------------------------- -->	        
	<div class="sitemap04" style="display:none">
	<table cellspacing="0">
		<colgroup>
			<col width="35%" />
	
			<col width="65%" />
		</colgroup>
		<tbody>
			<tr>
				<th>Smart 기상정보 서비스</th>
				<td>
					<ul>
						<li><a href="AG02_01.html">동네예보</a></li>
						<li><a href="AG03_01.html">서리정보(저온)</a></li>
						<li><a href="BG_01.html">기상특보</a></li>
						<li><a href="AG02_02.html" rel="external" data-ajax="false">제주 기상</a></li>
						<li><a href="AG02_03.html" rel="external" data-ajax="false">태풍정보</a></li>
					</ul>
				</td>
			</tr>
			<tr>
				<th>Smart SNS서비스</th>
				<td>
				<a href="javascript:go_sns();">영농상담</a>
				</td>
			</tr>
			<tr>
				<th>Smart 실시간 영농정보제공 서비스</th>
				<td>
					<ul>
						<li><a href="AG04_01.html" rel="external" data-ajax="false">주간영농정보</a></li>
						<li><a href="AG04_02.html" rel="external" data-ajax="false">병해충방제정보</a></li>
						<li><a href="AG04_03.html" rel="external" data-ajax="false">병해충도감</a></li>
						<!-- <li><a href="AG04_04.html" rel="external" data-ajax="false">병해충발생</a></li> -->
						<li><a href="AG04_05.html" rel="external" data-ajax="false">병해충발생</a></li>
						<li><a href="AG04_06.html" rel="external" data-ajax="false">작물보호제(농약지침)</a></li>
						<li class="last"><a href="AG04_07.html" rel="external" data-ajax="false">보호제혼용</a></li>
					</ul>
				</td>
			</tr>
		</tbody>
	</table>
	</div>	 
	<!-- // 사이트맵 -->
	<div id="content">
		<div id="title_W_id" class="sub_title_W">
	        <h3>동네예보</h3>
	        <div id="btn_edit_id" class="btn_add"><a href="javascript:edit_on_off();"><font style="color:#FFF;">지역편집</font></a></div>
	    </div>
	    
	    <div id="area_edit_id" class="area_edit">
	    	<ul>	
	    		<li id="editList0" class=""></li>
	    		<li id="editList1" class=""></li>
	    		<li id="editList2" class=""></li>
	    	</ul>
		    <div class="bottom_bar"></div>
	    </div>
	   	 
		
		<div id="lnb_W">
		    <ul>
				<li id="areaList0" class="select"></li>
				<li id="areaList1" class=""></li>
				<li id="areaList2" class=""></li>
		    </ul>
		</div>
		<div id="info"><img id="LoadingImage" src="../images/smart/loading_animation2.gif" width="276" height="240"></div>
	
		<div id="Windex" class="weather_index">
			<img class="left" src="../images/weather/bg_left.png">
	    	<img class="right" src="../images/weather/bg_right.png">
	    	<img class="sun_img" src="../images/weather/img01.png">
	    	<p>
	    	동네예보 페이지 입니다. 추가한 지역에 대한 기상 예보를 3시간 간격으로 확인할 수 있습니다.<br>
	    	</p>
	    	<p>
	    	<span>추가방법:</span><br>
	    	추가 버튼 선택 → 지역선택 → 예보확인<br>
	    	(단, 추가지역은 3개까지 가능합니다.)<br><br>
	    	<span>삭제방법:</span><br>
	    	삭제버튼 선택 → 지역선택 → 삭제<br>
	    	</p>
	    	<div class="btn_add">
		    	<a href='AG02_01_set.html' rel='external' data-ajax='false'>
					<font>지역추가하기</font>			
	    		</a>
	    	</div>
		</div>
	
		<div id="real_weather">	
		</div>
		
		<div id="get_weather">	
		</div>
	</div>
	<!-- //contents -->
	<div id="footer">
		<a href="index.html" rel="external" data-ajax="false">홈으로</a>|
		<a href="javascript:back_top()" class="gotop"><img src="../images/smart/main/arrow.png" width="9" height="10"/>맨 위로</a>
		<address><img src="../images/smart/footer_c.png" alt="ⓒ제주특별자치도 농업기술원" width="8" height="8"/> 제주특별자치도 농업기술원</address>
	</div>
	<!-- //footer -->
</div>
<!-- wrap -->
</body>
</html>